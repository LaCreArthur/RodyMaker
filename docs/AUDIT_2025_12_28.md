# Codebase Audit Report

> **Date:** 2025-12-28  
> **Scope:** Review of `./docs` and verification against actual code

---

## Summary

Identified dead code, dumb patterns, and overcomplexity. Immediate fixes applied, recommendations documented.

---

## ðŸ”´ Actions Taken

### 1. Deleted `JsonStoryProvider.cs` (483 lines)

**Location:** `Assets/Scripts/Providers/JsonStoryProvider.cs`

**Evidence:**
- `grep -r "new JsonStoryProvider" Assets/Scripts/` returned 0 matches
- ROADMAP.md explicitly flagged as "DEAD CODE"
- All story operations now go through `WorkingStory.cs`

**Status:** âœ… Deleted

### 2. Cleaned `Title.cs`

- Removed 2 commented-out `Debug.Log` lines
- Replaced magic number `10` with `konamiCode.Length`

**Status:** âœ… Fixed

### 3. Cleaned `MenuManager.cs`

- Removed 3 lines of commented-out dead code

**Status:** âœ… Fixed

### 4. Updated `ROADMAP.md`

- Marked Phase 3 as complete
- Updated deleted files table

**Status:** âœ… Updated

---

## ðŸŸ  Remaining Recommendations

### 1. PlayerPrefs as State Passing (Medium Priority)

The codebase passes critical runtime state via `PlayerPrefs` instead of using the already-existing `WorkingStory`:

| Key | Occurrences | Better Approach |
|-----|-------------|-----------------|
| `currentScene` | ~20 | Add `WorkingStory.CurrentSceneIndex` |
| `scenesCount` | ~15 | Already available as `WorkingStory.SceneCount` |
| `gamePath` | ~10 | Already available as `WorkingStory.Id` |

**Example of dumb pattern:**
```csharp
// Sets PlayerPrefs, then immediately reads from WorkingStory
PlayerPrefs.SetInt("scenesCount", WorkingStory.SceneCount);  // Redundant!
```

**Recommendation:** Add to `WorkingStory.cs`:
```csharp
public static int CurrentSceneIndex { get; set; } = 1;
```
Then refactor all `PlayerPrefs.GetInt("currentScene")` calls.

### 2. Ibiza String Matching (Low Priority)

`SceneLoading.cs` line 48-49:
```csharp
bool isIbiza = currentGame.Contains("Ibiza") || currentGame == "Rody Et Mastico A Ibiza";
```

This is brittle. Consider adding an `isIbiza` flag to story metadata.

### 3. Move `ExportedStory` Model (Low Priority)

`StoryExporter.cs` contains the `ExportedStory` class used throughout. Consider moving to `Assets/Scripts/Models/ExportedStory.cs` for clarity.

---

## ðŸŸ¢ Already Well-Cleaned Areas

Per DEVLOG.md, these were cleaned in Dec 2025:

| File | Before â†’ After | Removed |
|------|----------------|---------|
| `RM_SaveLoad.cs` | ~1073 â†’ ~450 lines | Folder-based code paths |
| `GameManager.cs` | ~451 â†’ ~290 lines | Dual init methods |
| `PathManager.cs` | 228 â†’ 29 lines | Dead path properties |
| `MenuManager.cs` | ~217 â†’ ~139 lines | Dual init methods |
| `Title.cs` | ~150 â†’ ~135 lines | Dual init methods |

The architecture is now unified around `WorkingStory` - no more dual code paths.

---

## Files Deleted

| File | Lines | Reason |
|------|-------|--------|
| `JsonStoryProvider.cs` | 483 | Never instantiated, completely dead |

**Total lines removed: ~490**

---

## Verification

```bash
# These patterns return no matches:
grep -r "JsonStoryProvider" Assets/Scripts/     # âœ… None
grep -r "streamingAssetsPath" Assets/Scripts/   # âœ… None
grep -r "LocalStoryProvider" Assets/Scripts/    # âœ… None
```
